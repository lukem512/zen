extends ../layout

block content
	h1= schedule.title

	script.
		var __id = '#{schedule.id}';
		var __past = #{past};

	script(src='/javascripts/ui/generic.js')
	script(src='/javascripts/ui/schedules.js')

	p
		a#user.text-capitalize(href="/users/#{schedule.owner}")
			if schedule.owner != user.username
				| #{schedule.owner} 
			else
				| you 
		if (new Date() - schedule.start_time) < 0
			if schedule.owner != user.username
				| has 
			else
				| have 
		| #{dictionary.schedule.verb.past} a #{dictionary.action.noun.plural} session for 
		a#startDate(href="#") #{moment(schedule.start_time).calendar()}
		| . 
	if schedule.description
		p
			| &ldquo;
			em= schedule.description
			| &rdquo;
	p#pledges

	#message.hidden
	#buttons
		if !past || user.admin
			hr
		if (schedule.owner != user.username) && !past
			button#btnJoin.btn.btn-success(type="button", onclick="join(window.location, '#{schedule.id}')") Join
			button#btnLeave.btn.btn-warning.hidden(type="button", onclick="leave(window.location, '#{schedule.id}')") Leave
			| &nbsp;
		if ((schedule.owner == user.username) && !past) || user.admin
			button#btnEdit.btn.btn-primary(type="button", onclick="window.location='/#{dictionary.schedule.noun.plural}/edit/#{schedule.id}'") Edit
			| &nbsp;
			button#btnDelete.btn.btn-danger(type="button", onclick="del('/#{dictionary.schedule.noun.plural}', '#{schedule.id}')") Delete
		script.
			$(function() {
				var startDate = moment('#{schedule.start_time}');
				$('#startDate').attr('href', '/#{dictionary.schedule.noun.plural}?date=' + startDate.format('DD-MM-YYYY') + '&view=day');
				$('#startDate').text(startDate.calendar());
			});
